{
  "version": 4,
  "terraform_version": "0.12.29",
  "serial": 57,
  "lineage": "736979ec-af9e-cc89-f3ad-34fc3b4c049c",
  "outputs": {
    "aws_profile": {
      "value": "default",
      "type": "string"
    },
    "cicd_keys": {
      "value": "terraform show -json | jq '.values.root_module.resources | .[] | select ( .address == \"aws_iam_access_key.cicd_keys\") | { AWS_ACCESS_KEY_ID: .values.id, AWS_SECRET_ACCESS_KEY: .values.secret }'",
      "type": "string"
    },
    "deploy": {
      "value": "fargate service deploy -f docker-compose.yml",
      "type": "string"
    },
    "docker_registry": {
      "value": "255847211468.dkr.ecr.us-east-1.amazonaws.com/itsm-server",
      "type": "string"
    },
    "endpoint": {
      "value": "https://itsm-server-dev.brandonregard.info",
      "type": "string"
    },
    "lb_dns": {
      "value": "itsm-server-dev-672657831.us-east-1.elb.amazonaws.com",
      "type": "string"
    },
    "scale_out": {
      "value": "fargate service scale -h",
      "type": "string"
    },
    "scale_up": {
      "value": "fargate service update -h",
      "type": "string"
    },
    "status": {
      "value": "fargate service info",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "archive_file",
      "name": "lambda_zip",
      "provider": "provider.archive",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "excludes": null,
            "id": "1f176d336495101ca88915823d18c42ce37496b4",
            "output_base64sha256": "+mHdOX3i/0vXJVbRt9I11ReaG6nZCs5Ppni00RNDPLg=",
            "output_md5": "6df8b5c23ea7bda6697573188f4b53a5",
            "output_path": "lambda-itsm-server.zip",
            "output_sha": "1f176d336495101ca88915823d18c42ce37496b4",
            "output_size": 218,
            "source": [],
            "source_content": "exports.handler = (event, context, callback) =\u003e {\n  console.log(JSON.stringify(event));\n}\n",
            "source_content_filename": "index.js",
            "source_dir": null,
            "source_file": null,
            "type": "zip"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_caller_identity",
      "name": "current",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "account_id": "255847211468",
            "arn": "arn:aws:iam::255847211468:user/brandon",
            "id": "2020-09-27 21:42:44.896105 +0000 UTC",
            "user_id": "AIDAIHSCAW6RPGMTRU5TU"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_ecr_repository",
      "name": "ecr",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ecr:us-east-1:255847211468:repository/itsm-server",
            "id": "itsm-server",
            "name": "itsm-server",
            "registry_id": "255847211468",
            "repository_url": "255847211468.dkr.ecr.us-east-1.amazonaws.com/itsm-server",
            "tags": {}
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_elb_service_account",
      "name": "main",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::127311923021:root",
            "id": "127311923021",
            "region": null
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "app_policy",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "3087109294",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"ecs:DescribeClusters\",\n      \"Resource\": \"arn:aws:ecs:us-east-1:255847211468:cluster/itsm-server-dev\"\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "ecs:DescribeClusters"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:ecs:us-east-1:255847211468:cluster/itsm-server-dev"
                ],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "app_role_assume_role_policy",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "1942710628",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::255847211468:user/brandon\",\n        \"Service\": \"ecs-tasks.amazonaws.com\"\n      }\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "sts:AssumeRole"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "arn:aws:iam::255847211468:user/brandon"
                    ],
                    "type": "AWS"
                  },
                  {
                    "identifiers": [
                      "ecs-tasks.amazonaws.com"
                    ],
                    "type": "Service"
                  }
                ],
                "resources": [],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "assume_role_policy",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "320642683",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"ecs-tasks.amazonaws.com\"\n      }\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "sts:AssumeRole"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "ecs-tasks.amazonaws.com"
                    ],
                    "type": "Service"
                  }
                ],
                "resources": [],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "cicd_policy",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "3966353363",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"ecr\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ecr:UploadLayerPart\",\n        \"ecr:PutImage\",\n        \"ecr:InitiateLayerUpload\",\n        \"ecr:GetDownloadUrlForLayer\",\n        \"ecr:CompleteLayerUpload\",\n        \"ecr:BatchGetImage\",\n        \"ecr:BatchCheckLayerAvailability\"\n      ],\n      \"Resource\": \"arn:aws:ecr:us-east-1:255847211468:repository/itsm-server\"\n    },\n    {\n      \"Sid\": \"ecs\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ecs:UpdateService\",\n        \"ecs:RegisterTaskDefinition\",\n        \"ecs:DescribeTaskDefinition\",\n        \"ecs:DescribeServices\",\n        \"ecr:GetAuthorizationToken\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"approle\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"iam:PassRole\",\n      \"Resource\": [\n        \"arn:aws:iam::255847211468:role/itsm-server-dev-ecs\",\n        \"arn:aws:iam::255847211468:role/itsm-server-dev\"\n      ]\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "ecr:BatchCheckLayerAvailability",
                  "ecr:BatchGetImage",
                  "ecr:CompleteLayerUpload",
                  "ecr:GetDownloadUrlForLayer",
                  "ecr:InitiateLayerUpload",
                  "ecr:PutImage",
                  "ecr:UploadLayerPart"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:ecr:us-east-1:255847211468:repository/itsm-server"
                ],
                "sid": "ecr"
              },
              {
                "actions": [
                  "ecr:GetAuthorizationToken",
                  "ecs:DescribeServices",
                  "ecs:DescribeTaskDefinition",
                  "ecs:RegisterTaskDefinition",
                  "ecs:UpdateService"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "*"
                ],
                "sid": "ecs"
              },
              {
                "actions": [
                  "iam:PassRole"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:iam::255847211468:role/itsm-server-dev",
                  "arn:aws:iam::255847211468:role/itsm-server-dev-ecs"
                ],
                "sid": "approle"
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "kms_resource_policy_doc",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "4258977851",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"DenyWrite\",\n      \"Effect\": \"Deny\",\n      \"Action\": [\n        \"kms:UpdateKeyDescription\",\n        \"kms:UpdateAlias\",\n        \"kms:UntagResource\",\n        \"kms:TagResource\",\n        \"kms:ScheduleKeyDeletion\",\n        \"kms:RevokeGrant\",\n        \"kms:RetireGrant\",\n        \"kms:ReEncryptTo\",\n        \"kms:ReEncryptFrom\",\n        \"kms:PutKeyPolicy\",\n        \"kms:ImportKeyMaterial\",\n        \"kms:GetParametersForImport\",\n        \"kms:GetKeyRotationStatus\",\n        \"kms:GetKeyPolicy\",\n        \"kms:GenerateRandom\",\n        \"kms:GenerateDataKeyWithoutPlaintext\",\n        \"kms:GenerateDataKey\",\n        \"kms:Encrypt\",\n        \"kms:EnableKeyRotation\",\n        \"kms:EnableKey\",\n        \"kms:DisableKeyRotation\",\n        \"kms:DisableKey\",\n        \"kms:DeleteImportedKeyMaterial\",\n        \"kms:DeleteAlias\",\n        \"kms:CreateKey\",\n        \"kms:CreateGrant\",\n        \"kms:CreateAlias\",\n        \"kms:CancelKeyDeletion\"\n      ],\n      \"Resource\": \"*\",\n      \"Principal\": {\n        \"AWS\": \"*\"\n      },\n      \"Condition\": {\n        \"StringNotLike\": {\n          \"aws:userId\": [\n            \"AIDAIHSCAW6RPGMTRU5TU\",\n            \"255847211468\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"DenyRead\",\n      \"Effect\": \"Deny\",\n      \"Action\": [\n        \"kms:List*\",\n        \"kms:DescribeKey\",\n        \"kms:Decrypt\"\n      ],\n      \"Resource\": \"*\",\n      \"Principal\": {\n        \"AWS\": \"*\"\n      },\n      \"Condition\": {\n        \"StringNotLike\": {\n          \"aws:userId\": [\n            \"AIDAIHSCAW6RPGMTRU5TU\",\n            \"255847211468\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"AllowWrite\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"kms:UpdateKeyDescription\",\n        \"kms:UpdateAlias\",\n        \"kms:UntagResource\",\n        \"kms:TagResource\",\n        \"kms:ScheduleKeyDeletion\",\n        \"kms:RevokeGrant\",\n        \"kms:RetireGrant\",\n        \"kms:ReEncryptTo\",\n        \"kms:ReEncryptFrom\",\n        \"kms:PutKeyPolicy\",\n        \"kms:ImportKeyMaterial\",\n        \"kms:GetParametersForImport\",\n        \"kms:GetKeyRotationStatus\",\n        \"kms:GetKeyPolicy\",\n        \"kms:GenerateRandom\",\n        \"kms:GenerateDataKeyWithoutPlaintext\",\n        \"kms:GenerateDataKey\",\n        \"kms:Encrypt\",\n        \"kms:EnableKeyRotation\",\n        \"kms:EnableKey\",\n        \"kms:DisableKeyRotation\",\n        \"kms:DisableKey\",\n        \"kms:DeleteImportedKeyMaterial\",\n        \"kms:DeleteAlias\",\n        \"kms:CreateKey\",\n        \"kms:CreateGrant\",\n        \"kms:CreateAlias\",\n        \"kms:CancelKeyDeletion\"\n      ],\n      \"Resource\": \"*\",\n      \"Principal\": {\n        \"AWS\": \"*\"\n      },\n      \"Condition\": {\n        \"StringLike\": {\n          \"aws:userId\": [\n            \"AIDAIHSCAW6RPGMTRU5TU\",\n            \"255847211468\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"AllowRead\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"kms:List*\",\n        \"kms:DescribeKey\",\n        \"kms:Decrypt\"\n      ],\n      \"Resource\": \"*\",\n      \"Principal\": {\n        \"AWS\": \"*\"\n      },\n      \"Condition\": {\n        \"StringLike\": {\n          \"aws:userId\": [\n            \"AIDAIHSCAW6RPGMTRU5TU\",\n            \"255847211468\"\n          ]\n        }\n      }\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "kms:CancelKeyDeletion",
                  "kms:CreateAlias",
                  "kms:CreateGrant",
                  "kms:CreateKey",
                  "kms:DeleteAlias",
                  "kms:DeleteImportedKeyMaterial",
                  "kms:DisableKey",
                  "kms:DisableKeyRotation",
                  "kms:EnableKey",
                  "kms:EnableKeyRotation",
                  "kms:Encrypt",
                  "kms:GenerateDataKey",
                  "kms:GenerateDataKeyWithoutPlaintext",
                  "kms:GenerateRandom",
                  "kms:GetKeyPolicy",
                  "kms:GetKeyRotationStatus",
                  "kms:GetParametersForImport",
                  "kms:ImportKeyMaterial",
                  "kms:PutKeyPolicy",
                  "kms:ReEncryptFrom",
                  "kms:ReEncryptTo",
                  "kms:RetireGrant",
                  "kms:RevokeGrant",
                  "kms:ScheduleKeyDeletion",
                  "kms:TagResource",
                  "kms:UntagResource",
                  "kms:UpdateAlias",
                  "kms:UpdateKeyDescription"
                ],
                "condition": [
                  {
                    "test": "StringNotLike",
                    "values": [
                      "255847211468",
                      "AIDAIHSCAW6RPGMTRU5TU"
                    ],
                    "variable": "aws:userId"
                  }
                ],
                "effect": "Deny",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "*"
                    ],
                    "type": "AWS"
                  }
                ],
                "resources": [
                  "*"
                ],
                "sid": "DenyWrite"
              },
              {
                "actions": [
                  "kms:Decrypt",
                  "kms:DescribeKey",
                  "kms:List*"
                ],
                "condition": [
                  {
                    "test": "StringNotLike",
                    "values": [
                      "255847211468",
                      "AIDAIHSCAW6RPGMTRU5TU"
                    ],
                    "variable": "aws:userId"
                  }
                ],
                "effect": "Deny",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "*"
                    ],
                    "type": "AWS"
                  }
                ],
                "resources": [
                  "*"
                ],
                "sid": "DenyRead"
              },
              {
                "actions": [
                  "kms:CancelKeyDeletion",
                  "kms:CreateAlias",
                  "kms:CreateGrant",
                  "kms:CreateKey",
                  "kms:DeleteAlias",
                  "kms:DeleteImportedKeyMaterial",
                  "kms:DisableKey",
                  "kms:DisableKeyRotation",
                  "kms:EnableKey",
                  "kms:EnableKeyRotation",
                  "kms:Encrypt",
                  "kms:GenerateDataKey",
                  "kms:GenerateDataKeyWithoutPlaintext",
                  "kms:GenerateRandom",
                  "kms:GetKeyPolicy",
                  "kms:GetKeyRotationStatus",
                  "kms:GetParametersForImport",
                  "kms:ImportKeyMaterial",
                  "kms:PutKeyPolicy",
                  "kms:ReEncryptFrom",
                  "kms:ReEncryptTo",
                  "kms:RetireGrant",
                  "kms:RevokeGrant",
                  "kms:ScheduleKeyDeletion",
                  "kms:TagResource",
                  "kms:UntagResource",
                  "kms:UpdateAlias",
                  "kms:UpdateKeyDescription"
                ],
                "condition": [
                  {
                    "test": "StringLike",
                    "values": [
                      "255847211468",
                      "AIDAIHSCAW6RPGMTRU5TU"
                    ],
                    "variable": "aws:userId"
                  }
                ],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "*"
                    ],
                    "type": "AWS"
                  }
                ],
                "resources": [
                  "*"
                ],
                "sid": "AllowWrite"
              },
              {
                "actions": [
                  "kms:Decrypt",
                  "kms:DescribeKey",
                  "kms:List*"
                ],
                "condition": [
                  {
                    "test": "StringLike",
                    "values": [
                      "255847211468",
                      "AIDAIHSCAW6RPGMTRU5TU"
                    ],
                    "variable": "aws:userId"
                  }
                ],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "*"
                    ],
                    "type": "AWS"
                  }
                ],
                "resources": [
                  "*"
                ],
                "sid": "AllowRead"
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "sm_resource_policy_doc",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "3246907944",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"DenyWrite\",\n      \"Effect\": \"Deny\",\n      \"Action\": [\n        \"secretsmanager:UpdateSecretVersionStage\",\n        \"secretsmanager:UpdateSecret\",\n        \"secretsmanager:UntagResource\",\n        \"secretsmanager:TagResource\",\n        \"secretsmanager:RotateSecret\",\n        \"secretsmanager:RestoreSecret\",\n        \"secretsmanager:PutSecretValue\",\n        \"secretsmanager:DeleteSecret\",\n        \"secretsmanager:CreateSecret\",\n        \"secretsmanager:CancelRotateSecret\"\n      ],\n      \"Resource\": \"arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-??????\",\n      \"Principal\": {\n        \"AWS\": \"*\"\n      },\n      \"Condition\": {\n        \"StringNotLike\": {\n          \"aws:userId\": [\n            \"AIDAIHSCAW6RPGMTRU5TU\",\n            \"255847211468\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"DenyRead\",\n      \"Effect\": \"Deny\",\n      \"Action\": [\n        \"secretsmanager:List*\",\n        \"secretsmanager:GetSecretValue\",\n        \"secretsmanager:GetRandomPassword\",\n        \"secretsmanager:DescribeSecret\"\n      ],\n      \"Resource\": \"arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-??????\",\n      \"Principal\": {\n        \"AWS\": \"*\"\n      },\n      \"Condition\": {\n        \"StringNotLike\": {\n          \"aws:userId\": [\n            \"AIDAIHSCAW6RPGMTRU5TU\",\n            \"255847211468\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"AllowWrite\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"secretsmanager:UpdateSecretVersionStage\",\n        \"secretsmanager:UpdateSecret\",\n        \"secretsmanager:UntagResource\",\n        \"secretsmanager:TagResource\",\n        \"secretsmanager:RotateSecret\",\n        \"secretsmanager:RestoreSecret\",\n        \"secretsmanager:PutSecretValue\",\n        \"secretsmanager:DeleteSecret\",\n        \"secretsmanager:CreateSecret\",\n        \"secretsmanager:CancelRotateSecret\"\n      ],\n      \"Resource\": \"arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-??????\",\n      \"Principal\": {\n        \"AWS\": \"*\"\n      },\n      \"Condition\": {\n        \"StringLike\": {\n          \"aws:userId\": [\n            \"AIDAIHSCAW6RPGMTRU5TU\",\n            \"255847211468\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"AllowRead\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"secretsmanager:List*\",\n        \"secretsmanager:GetSecretValue\",\n        \"secretsmanager:GetRandomPassword\",\n        \"secretsmanager:DescribeSecret\"\n      ],\n      \"Resource\": \"arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-??????\",\n      \"Principal\": {\n        \"AWS\": \"*\"\n      },\n      \"Condition\": {\n        \"StringLike\": {\n          \"aws:userId\": [\n            \"AIDAIHSCAW6RPGMTRU5TU\",\n            \"255847211468\"\n          ]\n        }\n      }\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "secretsmanager:CancelRotateSecret",
                  "secretsmanager:CreateSecret",
                  "secretsmanager:DeleteSecret",
                  "secretsmanager:PutSecretValue",
                  "secretsmanager:RestoreSecret",
                  "secretsmanager:RotateSecret",
                  "secretsmanager:TagResource",
                  "secretsmanager:UntagResource",
                  "secretsmanager:UpdateSecret",
                  "secretsmanager:UpdateSecretVersionStage"
                ],
                "condition": [
                  {
                    "test": "StringNotLike",
                    "values": [
                      "255847211468",
                      "AIDAIHSCAW6RPGMTRU5TU"
                    ],
                    "variable": "aws:userId"
                  }
                ],
                "effect": "Deny",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "*"
                    ],
                    "type": "AWS"
                  }
                ],
                "resources": [
                  "arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-??????"
                ],
                "sid": "DenyWrite"
              },
              {
                "actions": [
                  "secretsmanager:DescribeSecret",
                  "secretsmanager:GetRandomPassword",
                  "secretsmanager:GetSecretValue",
                  "secretsmanager:List*"
                ],
                "condition": [
                  {
                    "test": "StringNotLike",
                    "values": [
                      "255847211468",
                      "AIDAIHSCAW6RPGMTRU5TU"
                    ],
                    "variable": "aws:userId"
                  }
                ],
                "effect": "Deny",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "*"
                    ],
                    "type": "AWS"
                  }
                ],
                "resources": [
                  "arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-??????"
                ],
                "sid": "DenyRead"
              },
              {
                "actions": [
                  "secretsmanager:CancelRotateSecret",
                  "secretsmanager:CreateSecret",
                  "secretsmanager:DeleteSecret",
                  "secretsmanager:PutSecretValue",
                  "secretsmanager:RestoreSecret",
                  "secretsmanager:RotateSecret",
                  "secretsmanager:TagResource",
                  "secretsmanager:UntagResource",
                  "secretsmanager:UpdateSecret",
                  "secretsmanager:UpdateSecretVersionStage"
                ],
                "condition": [
                  {
                    "test": "StringLike",
                    "values": [
                      "255847211468",
                      "AIDAIHSCAW6RPGMTRU5TU"
                    ],
                    "variable": "aws:userId"
                  }
                ],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "*"
                    ],
                    "type": "AWS"
                  }
                ],
                "resources": [
                  "arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-??????"
                ],
                "sid": "AllowWrite"
              },
              {
                "actions": [
                  "secretsmanager:DescribeSecret",
                  "secretsmanager:GetRandomPassword",
                  "secretsmanager:GetSecretValue",
                  "secretsmanager:List*"
                ],
                "condition": [
                  {
                    "test": "StringLike",
                    "values": [
                      "255847211468",
                      "AIDAIHSCAW6RPGMTRU5TU"
                    ],
                    "variable": "aws:userId"
                  }
                ],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "*"
                    ],
                    "type": "AWS"
                  }
                ],
                "resources": [
                  "arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-??????"
                ],
                "sid": "AllowRead"
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_route53_zone",
      "name": "app",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "caller_reference": "RISWorkflow-RD:133515d9-b3aa-45d4-96a8-7c7b7876471c",
            "comment": "HostedZone created by Route53 Registrar",
            "id": "Z1S6PFDX73G0UH",
            "linked_service_description": null,
            "linked_service_principal": null,
            "name": "brandonregard.info.",
            "name_servers": [
              "ns-640.awsdns-16.net",
              "ns-1207.awsdns-22.org",
              "ns-1753.awsdns-27.co.uk",
              "ns-461.awsdns-57.com"
            ],
            "private_zone": false,
            "resource_record_set_count": 2,
            "tags": {},
            "vpc_id": null,
            "zone_id": "Z1S6PFDX73G0UH"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "template_file",
      "name": "lambda_source",
      "provider": "provider.template",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "43b9ebc0162837ea617584538a58fd593be06ee623b4fc8d099c9a6e4d7e3c41",
            "rendered": "exports.handler = (event, context, callback) =\u003e {\n  console.log(JSON.stringify(event));\n}\n",
            "template": "exports.handler = (event, context, callback) =\u003e {\n  console.log(JSON.stringify(event));\n}\n",
            "vars": null
          }
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_acm_certificate",
      "name": "cert",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:acm:us-east-1:255847211468:certificate/138a68a9-768a-4b7c-ad6a-97668ea2a84c",
            "certificate_authority_arn": "",
            "certificate_body": null,
            "certificate_chain": null,
            "domain_name": "itsm-server-dev.brandonregard.info",
            "domain_validation_options": [
              {
                "domain_name": "itsm-server-dev.brandonregard.info",
                "resource_record_name": "_a0cb06e110eb1cf3830c510f4bd734c0.itsm-server-dev.brandonregard.info.",
                "resource_record_type": "CNAME",
                "resource_record_value": "_d9cddec6187d2a6b6908e16f89ea0b1f.bsgbmzkfwj.acm-validations.aws."
              }
            ],
            "id": "arn:aws:acm:us-east-1:255847211468:certificate/138a68a9-768a-4b7c-ad6a-97668ea2a84c",
            "options": [
              {
                "certificate_transparency_logging_preference": "ENABLED"
              }
            ],
            "private_key": null,
            "status": "ISSUED",
            "subject_alternative_names": [],
            "tags": {},
            "validation_emails": [],
            "validation_method": "DNS"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_acm_certificate_validation",
      "name": "cert",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "certificate_arn": "arn:aws:acm:us-east-1:255847211468:certificate/138a68a9-768a-4b7c-ad6a-97668ea2a84c",
            "id": "2020-09-27 21:28:40 +0000 UTC",
            "timeouts": null,
            "validation_record_fqdns": [
              "_a0cb06e110eb1cf3830c510f4bd734c0.itsm-server-dev.brandonregard.info"
            ]
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoyNzAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "aws_acm_certificate.cert",
            "aws_route53_record.cert_validation"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_alb",
      "name": "main",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "access_logs": [
              {
                "bucket": "itsm-server-dev-lb-access-logs",
                "enabled": true,
                "prefix": ""
              }
            ],
            "arn": "arn:aws:elasticloadbalancing:us-east-1:255847211468:loadbalancer/app/itsm-server-dev/f6f7a59203208535",
            "arn_suffix": "app/itsm-server-dev/f6f7a59203208535",
            "dns_name": "itsm-server-dev-672657831.us-east-1.elb.amazonaws.com",
            "drop_invalid_header_fields": false,
            "enable_cross_zone_load_balancing": null,
            "enable_deletion_protection": false,
            "enable_http2": true,
            "id": "arn:aws:elasticloadbalancing:us-east-1:255847211468:loadbalancer/app/itsm-server-dev/f6f7a59203208535",
            "idle_timeout": 60,
            "internal": false,
            "ip_address_type": "ipv4",
            "load_balancer_type": "application",
            "name": "itsm-server-dev",
            "name_prefix": null,
            "security_groups": [
              "sg-0ac5daf49ac9b66fd"
            ],
            "subnet_mapping": [
              {
                "allocation_id": "",
                "subnet_id": "subnet-0946d3f99953ac98a"
              },
              {
                "allocation_id": "",
                "subnet_id": "subnet-0dde81d9e5468eb5d"
              }
            ],
            "subnets": [
              "subnet-0946d3f99953ac98a",
              "subnet-0dde81d9e5468eb5d"
            ],
            "tags": {
              "application": "itsm-server",
              "environment": "dev"
            },
            "timeouts": null,
            "vpc_id": "vpc-0b3c769c8c579098f",
            "zone_id": "Z35SXDOTRQ7X7K"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH19",
          "dependencies": [
            "aws_s3_bucket.lb_access_logs",
            "aws_security_group.nsg_lb"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_alb_listener",
      "name": "https",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:elasticloadbalancing:us-east-1:255847211468:listener/app/itsm-server-dev/f6f7a59203208535/195e085c3d4b1acc",
            "certificate_arn": "arn:aws:acm:us-east-1:255847211468:certificate/138a68a9-768a-4b7c-ad6a-97668ea2a84c",
            "default_action": [
              {
                "authenticate_cognito": [],
                "authenticate_oidc": [],
                "fixed_response": [],
                "forward": [],
                "order": 1,
                "redirect": [],
                "target_group_arn": "arn:aws:elasticloadbalancing:us-east-1:255847211468:targetgroup/itsm-server-dev/b9ad35726031e7bf",
                "type": "forward"
              }
            ],
            "id": "arn:aws:elasticloadbalancing:us-east-1:255847211468:listener/app/itsm-server-dev/f6f7a59203208535/195e085c3d4b1acc",
            "load_balancer_arn": "arn:aws:elasticloadbalancing:us-east-1:255847211468:loadbalancer/app/itsm-server-dev/f6f7a59203208535",
            "port": 443,
            "protocol": "HTTPS",
            "ssl_policy": "ELBSecurityPolicy-2016-08",
            "timeouts": null
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsicmVhZCI6NjAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "aws_acm_certificate_validation.cert",
            "aws_alb.main",
            "aws_alb_target_group.main",
            "aws_s3_bucket.lb_access_logs",
            "aws_security_group.nsg_lb"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_alb_target_group",
      "name": "main",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:elasticloadbalancing:us-east-1:255847211468:targetgroup/itsm-server-dev/b9ad35726031e7bf",
            "arn_suffix": "targetgroup/itsm-server-dev/b9ad35726031e7bf",
            "deregistration_delay": 30,
            "health_check": [
              {
                "enabled": true,
                "healthy_threshold": 5,
                "interval": 30,
                "matcher": "200",
                "path": "/health",
                "port": "traffic-port",
                "protocol": "HTTP",
                "timeout": 10,
                "unhealthy_threshold": 5
              }
            ],
            "id": "arn:aws:elasticloadbalancing:us-east-1:255847211468:targetgroup/itsm-server-dev/b9ad35726031e7bf",
            "lambda_multi_value_headers_enabled": false,
            "load_balancing_algorithm_type": "round_robin",
            "name": "itsm-server-dev",
            "name_prefix": null,
            "port": 80,
            "protocol": "HTTP",
            "proxy_protocol_v2": false,
            "slow_start": 0,
            "stickiness": [
              {
                "cookie_duration": 86400,
                "enabled": false,
                "type": "lb_cookie"
              }
            ],
            "tags": {
              "application": "itsm-server",
              "environment": "dev"
            },
            "target_type": "ip",
            "vpc_id": "vpc-0b3c769c8c579098f"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_alb.main",
            "aws_s3_bucket.lb_access_logs",
            "aws_security_group.nsg_lb"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_appautoscaling_policy",
      "name": "app_down",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "adjustment_type": null,
            "arn": "arn:aws:autoscaling:us-east-1:255847211468:scalingPolicy:47d5ed4a-adbf-4189-812d-f77152d95812:resource/ecs/service/itsm-server-dev/itsm-server-dev:policyName/app-scale-down",
            "cooldown": null,
            "id": "app-scale-down",
            "metric_aggregation_type": null,
            "min_adjustment_magnitude": null,
            "name": "app-scale-down",
            "policy_type": "StepScaling",
            "resource_id": "service/itsm-server-dev/itsm-server-dev",
            "scalable_dimension": "ecs:service:DesiredCount",
            "service_namespace": "ecs",
            "step_adjustment": [],
            "step_scaling_policy_configuration": [
              {
                "adjustment_type": "ChangeInCapacity",
                "cooldown": 300,
                "metric_aggregation_type": "Average",
                "min_adjustment_magnitude": 0,
                "step_adjustment": [
                  {
                    "metric_interval_lower_bound": "",
                    "metric_interval_upper_bound": "0",
                    "scaling_adjustment": -1
                  }
                ]
              }
            ],
            "target_tracking_scaling_policy_configuration": []
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_alb_target_group.main",
            "aws_appautoscaling_target.app_scale_target",
            "aws_ecs_cluster.app",
            "aws_ecs_service.app",
            "aws_ecs_task_definition.app",
            "aws_security_group.nsg_task"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_appautoscaling_policy",
      "name": "app_up",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "adjustment_type": null,
            "arn": "arn:aws:autoscaling:us-east-1:255847211468:scalingPolicy:47d5ed4a-adbf-4189-812d-f77152d95812:resource/ecs/service/itsm-server-dev/itsm-server-dev:policyName/app-scale-up",
            "cooldown": null,
            "id": "app-scale-up",
            "metric_aggregation_type": null,
            "min_adjustment_magnitude": null,
            "name": "app-scale-up",
            "policy_type": "StepScaling",
            "resource_id": "service/itsm-server-dev/itsm-server-dev",
            "scalable_dimension": "ecs:service:DesiredCount",
            "service_namespace": "ecs",
            "step_adjustment": [],
            "step_scaling_policy_configuration": [
              {
                "adjustment_type": "ChangeInCapacity",
                "cooldown": 60,
                "metric_aggregation_type": "Average",
                "min_adjustment_magnitude": 0,
                "step_adjustment": [
                  {
                    "metric_interval_lower_bound": "0",
                    "metric_interval_upper_bound": "",
                    "scaling_adjustment": 1
                  }
                ]
              }
            ],
            "target_tracking_scaling_policy_configuration": []
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_alb_target_group.main",
            "aws_appautoscaling_target.app_scale_target",
            "aws_ecs_cluster.app",
            "aws_ecs_service.app",
            "aws_ecs_task_definition.app",
            "aws_security_group.nsg_task"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_appautoscaling_target",
      "name": "app_scale_target",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "service/itsm-server-dev/itsm-server-dev",
            "max_capacity": 1,
            "min_capacity": 1,
            "resource_id": "service/itsm-server-dev/itsm-server-dev",
            "role_arn": "arn:aws:iam::255847211468:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService",
            "scalable_dimension": "ecs:service:DesiredCount",
            "service_namespace": "ecs"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_alb_target_group.main",
            "aws_ecs_cluster.app",
            "aws_ecs_service.app",
            "aws_ecs_task_definition.app",
            "aws_security_group.nsg_task"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudwatch_dashboard",
      "name": "cloudwatch_dashboard",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "dashboard_arn": "arn:aws:cloudwatch::255847211468:dashboard/itsm-server-dev-fargate",
            "dashboard_body": "{\"widgets\":[{\"type\":\"metric\",\"x\":12,\"y\":6,\"width\":12,\"height\":6,\"properties\":{\"view\":\"timeSeries\",\"stacked\":false,\"metrics\":[[\"AWS/ECS\",\"MemoryUtilization\",\"ServiceName\",\"itsm-server-dev\",\"ClusterName\",\"itsm-server-dev\",{\"color\":\"#1f77b4\"}],[\".\",\"CPUUtilization\",\".\",\".\",\".\",\".\",{\"color\":\"#9467bd\"}]],\"region\":\"us-east-1\",\"period\":300,\"title\":\"Memory and CPU utilization\",\"yAxis\":{\"left\":{\"min\":0,\"max\":100}}}},{\"type\":\"metric\",\"x\":0,\"y\":6,\"width\":12,\"height\":6,\"properties\":{\"view\":\"timeSeries\",\"stacked\":true,\"metrics\":[[\"AWS/ApplicationELB\",\"HTTPCode_Target_5XX_Count\",\"TargetGroup\",\"targetgroup/itsm-server-dev/b9ad35726031e7bf\",\"LoadBalancer\",\"app/itsm-server-dev/f6f7a59203208535\",{\"period\":60,\"color\":\"#d62728\",\"stat\":\"Sum\"}],[\".\",\"HTTPCode_Target_4XX_Count\",\".\",\".\",\".\",\".\",{\"period\":60,\"stat\":\"Sum\",\"color\":\"#bcbd22\"}],[\".\",\"HTTPCode_Target_3XX_Count\",\".\",\".\",\".\",\".\",{\"period\":60,\"stat\":\"Sum\",\"color\":\"#98df8a\"}],[\".\",\"HTTPCode_Target_2XX_Count\",\".\",\".\",\".\",\".\",{\"period\":60,\"stat\":\"Sum\",\"color\":\"#2ca02c\"}]],\"region\":\"us-east-1\",\"title\":\"Container responses\",\"period\":300,\"yAxis\":{\"left\":{\"min\":0}}}},{\"type\":\"metric\",\"x\":12,\"y\":0,\"width\":12,\"height\":6,\"properties\":{\"view\":\"timeSeries\",\"stacked\":false,\"metrics\":[[\"AWS/ApplicationELB\",\"TargetResponseTime\",\"LoadBalancer\",\"app/itsm-server-dev/f6f7a59203208535\",{\"period\":60,\"stat\":\"p50\"}],[\"...\",{\"period\":60,\"stat\":\"p90\",\"color\":\"#c5b0d5\"}],[\"...\",{\"period\":60,\"stat\":\"p99\",\"color\":\"#dbdb8d\"}]],\"region\":\"us-east-1\",\"period\":300,\"yAxis\":{\"left\":{\"min\":0,\"max\":3}},\"title\":\"Container response times\"}},{\"type\":\"metric\",\"x\":12,\"y\":12,\"width\":12,\"height\":2,\"properties\":{\"view\":\"singleValue\",\"metrics\":[[\"AWS/ApplicationELB\",\"HealthyHostCount\",\"TargetGroup\",\"targetgroup/itsm-server-dev/b9ad35726031e7bf\",\"LoadBalancer\",\"app/itsm-server-dev/f6f7a59203208535\",{\"color\":\"#2ca02c\",\"period\":60}],[\".\",\"UnHealthyHostCount\",\".\",\".\",\".\",\".\",{\"color\":\"#d62728\",\"period\":60}]],\"region\":\"us-east-1\",\"period\":300,\"stacked\":false}},{\"type\":\"metric\",\"x\":0,\"y\":0,\"width\":12,\"height\":6,\"properties\":{\"view\":\"timeSeries\",\"stacked\":true,\"metrics\":[[\"AWS/ApplicationELB\",\"HTTPCode_Target_5XX_Count\",\"LoadBalancer\",\"app/itsm-server-dev/f6f7a59203208535\",{\"period\":60,\"stat\":\"Sum\",\"color\":\"#d62728\"}],[\".\",\"HTTPCode_Target_4XX_Count\",\".\",\".\",{\"period\":60,\"stat\":\"Sum\",\"color\":\"#bcbd22\"}],[\".\",\"HTTPCode_Target_3XX_Count\",\".\",\".\",{\"period\":60,\"stat\":\"Sum\",\"color\":\"#98df8a\"}],[\".\",\"HTTPCode_Target_2XX_Count\",\".\",\".\",{\"period\":60,\"stat\":\"Sum\",\"color\":\"#2ca02c\"}]],\"region\":\"us-east-1\",\"title\":\"Load balancer responses\",\"period\":300,\"yAxis\":{\"left\":{\"min\":0}}}}]}\n",
            "dashboard_name": "itsm-server-dev-fargate",
            "id": "itsm-server-dev-fargate"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_alb.main",
            "aws_alb_target_group.main",
            "aws_s3_bucket.lb_access_logs",
            "aws_security_group.nsg_lb"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudwatch_dashboard",
      "name": "ecs-event-stream",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "dashboard_arn": "arn:aws:cloudwatch::255847211468:dashboard/itsm-server-dev-ecs-event-stream",
            "dashboard_body": "{\n  \"widgets\": [\n    {\n      \"type\": \"log\",\n      \"x\": 0,\n      \"y\": 0,\n      \"width\": 24,\n      \"height\": 18,\n      \"properties\": {\n        \"query\": \"SOURCE '/aws/lambda/itsm-server-dev-ecs-event-stream' | fields @timestamp as time, detail.desiredStatus as desired, detail.lastStatus as latest, detail.stoppedReason as reason, detail.containers.0.reason as container_reason, detail.taskDefinitionArn as task_definition\\n| filter @type != \\\"START\\\" and @type != \\\"END\\\" and @type != \\\"REPORT\\\"\\n| sort detail.updatedAt desc, detail.version desc\\n| limit 100\",\n        \"region\": \"us-east-1\",\n        \"title\": \"ECS Event Log\"\n      }\n    }\n  ]\n}\n",
            "dashboard_name": "itsm-server-dev-ecs-event-stream",
            "id": "itsm-server-dev-ecs-event-stream"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudwatch_event_rule",
      "name": "ecs_event_stream",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:events:us-east-1:255847211468:rule/itsm-server-dev-ecs-event-stream",
            "description": "Passes ecs event logs for itsm-server-dev to a lambda that writes them to cw logs",
            "event_pattern": "{\"detail\":{\"clusterArn\":[\"arn:aws:ecs:us-east-1:255847211468:cluster/itsm-server-dev\"]}}",
            "id": "itsm-server-dev-ecs-event-stream",
            "is_enabled": true,
            "name": "itsm-server-dev-ecs-event-stream",
            "name_prefix": null,
            "role_arn": "",
            "schedule_expression": "",
            "tags": {}
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_ecs_cluster.app"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudwatch_event_target",
      "name": "ecs_event_stream",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:lambda:us-east-1:255847211468:function:itsm-server-dev-ecs-event-stream",
            "batch_target": [],
            "ecs_target": [],
            "id": "itsm-server-dev-ecs-event-stream-terraform-20200927213114598600000001",
            "input": "",
            "input_path": "",
            "input_transformer": [],
            "kinesis_target": [],
            "role_arn": "",
            "rule": "itsm-server-dev-ecs-event-stream",
            "run_command_targets": [],
            "sqs_target": [],
            "target_id": "terraform-20200927213114598600000001"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_cloudwatch_event_rule.ecs_event_stream",
            "aws_iam_role.ecs_event_stream",
            "aws_lambda_function.ecs_event_stream"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudwatch_log_group",
      "name": "logs",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:logs:us-east-1:255847211468:log-group:/fargate/service/itsm-server-dev:*",
            "id": "/fargate/service/itsm-server-dev",
            "kms_key_id": "",
            "name": "/fargate/service/itsm-server-dev",
            "name_prefix": null,
            "retention_in_days": 90,
            "tags": {
              "application": "itsm-server",
              "environment": "dev"
            }
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudwatch_metric_alarm",
      "name": "cpu_utilization_high",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "actions_enabled": true,
            "alarm_actions": [
              "arn:aws:autoscaling:us-east-1:255847211468:scalingPolicy:47d5ed4a-adbf-4189-812d-f77152d95812:resource/ecs/service/itsm-server-dev/itsm-server-dev:policyName/app-scale-up"
            ],
            "alarm_description": "",
            "alarm_name": "itsm-server-dev-CPU-Utilization-High-80",
            "arn": "arn:aws:cloudwatch:us-east-1:255847211468:alarm:itsm-server-dev-CPU-Utilization-High-80",
            "comparison_operator": "GreaterThanOrEqualToThreshold",
            "datapoints_to_alarm": 0,
            "dimensions": {
              "ClusterName": "itsm-server-dev",
              "ServiceName": "itsm-server-dev"
            },
            "evaluate_low_sample_count_percentiles": "",
            "evaluation_periods": 1,
            "extended_statistic": "",
            "id": "itsm-server-dev-CPU-Utilization-High-80",
            "insufficient_data_actions": [],
            "metric_name": "CPUUtilization",
            "metric_query": [],
            "namespace": "AWS/ECS",
            "ok_actions": [],
            "period": 60,
            "statistic": "Average",
            "tags": {},
            "threshold": 80,
            "threshold_metric_id": "",
            "treat_missing_data": "missing",
            "unit": ""
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_alb_target_group.main",
            "aws_appautoscaling_policy.app_up",
            "aws_appautoscaling_target.app_scale_target",
            "aws_ecs_cluster.app",
            "aws_ecs_service.app",
            "aws_ecs_task_definition.app",
            "aws_security_group.nsg_task"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudwatch_metric_alarm",
      "name": "cpu_utilization_low",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "actions_enabled": true,
            "alarm_actions": [
              "arn:aws:autoscaling:us-east-1:255847211468:scalingPolicy:47d5ed4a-adbf-4189-812d-f77152d95812:resource/ecs/service/itsm-server-dev/itsm-server-dev:policyName/app-scale-down"
            ],
            "alarm_description": "",
            "alarm_name": "itsm-server-dev-CPU-Utilization-Low-20",
            "arn": "arn:aws:cloudwatch:us-east-1:255847211468:alarm:itsm-server-dev-CPU-Utilization-Low-20",
            "comparison_operator": "LessThanThreshold",
            "datapoints_to_alarm": 0,
            "dimensions": {
              "ClusterName": "itsm-server-dev",
              "ServiceName": "itsm-server-dev"
            },
            "evaluate_low_sample_count_percentiles": "",
            "evaluation_periods": 1,
            "extended_statistic": "",
            "id": "itsm-server-dev-CPU-Utilization-Low-20",
            "insufficient_data_actions": [],
            "metric_name": "CPUUtilization",
            "metric_query": [],
            "namespace": "AWS/ECS",
            "ok_actions": [],
            "period": 60,
            "statistic": "Average",
            "tags": {},
            "threshold": 20,
            "threshold_metric_id": "",
            "treat_missing_data": "missing",
            "unit": ""
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_alb_target_group.main",
            "aws_appautoscaling_policy.app_down",
            "aws_appautoscaling_target.app_scale_target",
            "aws_ecs_cluster.app",
            "aws_ecs_service.app",
            "aws_ecs_task_definition.app",
            "aws_security_group.nsg_task"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_ecs_cluster",
      "name": "app",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ecs:us-east-1:255847211468:cluster/itsm-server-dev",
            "capacity_providers": [],
            "default_capacity_provider_strategy": [],
            "id": "arn:aws:ecs:us-east-1:255847211468:cluster/itsm-server-dev",
            "name": "itsm-server-dev",
            "setting": [
              {
                "name": "containerInsights",
                "value": "enabled"
              }
            ],
            "tags": {
              "application": "itsm-server",
              "environment": "dev"
            }
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_ecs_service",
      "name": "app",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "capacity_provider_strategy": [],
            "cluster": "arn:aws:ecs:us-east-1:255847211468:cluster/itsm-server-dev",
            "deployment_controller": [
              {
                "type": "ECS"
              }
            ],
            "deployment_maximum_percent": 200,
            "deployment_minimum_healthy_percent": 100,
            "desired_count": 1,
            "enable_ecs_managed_tags": false,
            "force_new_deployment": null,
            "health_check_grace_period_seconds": 0,
            "iam_role": "aws-service-role",
            "id": "arn:aws:ecs:us-east-1:255847211468:service/itsm-server-dev",
            "launch_type": "FARGATE",
            "load_balancer": [
              {
                "container_name": "itsm-server",
                "container_port": 3000,
                "elb_name": "",
                "target_group_arn": "arn:aws:elasticloadbalancing:us-east-1:255847211468:targetgroup/itsm-server-dev/b9ad35726031e7bf"
              }
            ],
            "name": "itsm-server-dev",
            "network_configuration": [
              {
                "assign_public_ip": false,
                "security_groups": [
                  "sg-0e921122ff97e5520"
                ],
                "subnets": [
                  "subnet-00575e5b8c6093fa9",
                  "subnet-09fe7047d62dda00a"
                ]
              }
            ],
            "ordered_placement_strategy": [],
            "placement_constraints": [],
            "placement_strategy": [],
            "platform_version": "LATEST",
            "propagate_tags": "NONE",
            "scheduling_strategy": "REPLICA",
            "service_registries": [],
            "tags": {},
            "task_definition": "arn:aws:ecs:us-east-1:255847211468:task-definition/itsm-server-dev:2",
            "timeouts": null
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiZGVsZXRlIjoxMjAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "aws_alb_target_group.main",
            "aws_ecs_cluster.app",
            "aws_ecs_task_definition.app",
            "aws_security_group.nsg_task"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_ecs_task_definition",
      "name": "app",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ecs:us-east-1:255847211468:task-definition/itsm-server-dev:2",
            "container_definitions": "[{\"cpu\":0,\"environment\":[{\"name\":\"ENABLE_LOGGING\",\"value\":\"false\"},{\"name\":\"ENVIRONMENT\",\"value\":\"dev\"},{\"name\":\"HEALTHCHECK\",\"value\":\"/health\"},{\"name\":\"PORT\",\"value\":\"3000\"},{\"name\":\"PRODUCT\",\"value\":\"itsm-server\"}],\"essential\":true,\"image\":\"quay.io/turner/turner-defaultbackend:0.2.0\",\"logConfiguration\":{\"logDriver\":\"awslogs\",\"options\":{\"awslogs-group\":\"/fargate/service/itsm-server-dev\",\"awslogs-region\":\"us-east-1\",\"awslogs-stream-prefix\":\"ecs\"}},\"mountPoints\":[],\"name\":\"itsm-server\",\"portMappings\":[{\"containerPort\":3000,\"hostPort\":3000,\"protocol\":\"tcp\"}],\"volumesFrom\":[]}]",
            "cpu": "256",
            "execution_role_arn": "arn:aws:iam::255847211468:role/itsm-server-dev-ecs",
            "family": "itsm-server-dev",
            "id": "itsm-server-dev",
            "inference_accelerator": [],
            "ipc_mode": "",
            "memory": "512",
            "network_mode": "awsvpc",
            "pid_mode": "",
            "placement_constraints": [],
            "proxy_configuration": [],
            "requires_compatibilities": [
              "FARGATE"
            ],
            "revision": 2,
            "tags": {
              "application": "itsm-server",
              "environment": "dev"
            },
            "task_role_arn": "arn:aws:iam::255847211468:role/itsm-server-dev",
            "volume": []
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_iam_role.app_role",
            "aws_iam_role.ecsTaskExecutionRole"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_access_key",
      "name": "cicd_keys",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "encrypted_secret": null,
            "id": "AKIATXENOUHGJQUC77RQ",
            "key_fingerprint": null,
            "pgp_key": null,
            "secret": "+7/qwj9cdR6xgNoXSVfAvT6fRkvsKZcLnEjbQtVc",
            "ses_smtp_password": "AulMjc9keas6UJ3ErnuX4mAUbGEiiRE4G0JvVSSNsxlr",
            "ses_smtp_password_v4": "BGg28z6V+TK8S6plTJsUgimOMe+Ml+xN8fbv57GEgwMH",
            "status": "Active",
            "user": "srv_itsm-server_dev_cicd"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_user.cicd"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "app_role",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::255847211468:role/itsm-server-dev",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ecs-tasks.amazonaws.com\",\"AWS\":\"arn:aws:iam::255847211468:user/brandon\"},\"Action\":\"sts:AssumeRole\"}]}",
            "create_date": "2020-09-27T21:28:03Z",
            "description": "",
            "force_detach_policies": false,
            "id": "itsm-server-dev",
            "max_session_duration": 3600,
            "name": "itsm-server-dev",
            "name_prefix": null,
            "path": "/",
            "permissions_boundary": null,
            "tags": {},
            "unique_id": "AROATXENOUHGD2HCF3ZTB"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "ecsTaskExecutionRole",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::255847211468:role/itsm-server-dev-ecs",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ecs-tasks.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
            "create_date": "2020-09-27T21:28:02Z",
            "description": "",
            "force_detach_policies": false,
            "id": "itsm-server-dev-ecs",
            "max_session_duration": 3600,
            "name": "itsm-server-dev-ecs",
            "name_prefix": null,
            "path": "/",
            "permissions_boundary": null,
            "tags": {},
            "unique_id": "AROATXENOUHGMQAUEHQYK"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "ecs_event_stream",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::255847211468:role/itsm-server-dev-ecs-event-stream",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
            "create_date": "2020-09-27T21:28:13Z",
            "description": "",
            "force_detach_policies": false,
            "id": "itsm-server-dev-ecs-event-stream",
            "max_session_duration": 3600,
            "name": "itsm-server-dev-ecs-event-stream",
            "name_prefix": null,
            "path": "/",
            "permissions_boundary": null,
            "tags": {},
            "unique_id": "AROATXENOUHGLP6H4QFUW"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_cloudwatch_event_rule.ecs_event_stream",
            "aws_ecs_cluster.app"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy",
      "name": "app_policy",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "itsm-server-dev:itsm-server-dev",
            "name": "itsm-server-dev",
            "name_prefix": null,
            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"ecs:DescribeClusters\",\n      \"Resource\": \"arn:aws:ecs:us-east-1:255847211468:cluster/itsm-server-dev\"\n    }\n  ]\n}",
            "role": "itsm-server-dev"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_ecs_cluster.app",
            "aws_iam_role.app_role"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy_attachment",
      "name": "ecsTaskExecutionRole_policy",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "itsm-server-dev-ecs-20200927212803234800000002",
            "policy_arn": "arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
            "role": "itsm-server-dev-ecs"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.ecsTaskExecutionRole"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy_attachment",
      "name": "ecs_event_stream",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "itsm-server-dev-ecs-event-stream-20200927212813866100000003",
            "policy_arn": "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
            "role": "itsm-server-dev-ecs-event-stream"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_cloudwatch_event_rule.ecs_event_stream",
            "aws_ecs_cluster.app",
            "aws_iam_role.ecs_event_stream"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_user",
      "name": "cicd",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::255847211468:user/srv_itsm-server_dev_cicd",
            "force_destroy": false,
            "id": "srv_itsm-server_dev_cicd",
            "name": "srv_itsm-server_dev_cicd",
            "path": "/",
            "permissions_boundary": null,
            "tags": {},
            "unique_id": "AIDATXENOUHGAR76TQNV2"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_user_policy",
      "name": "cicd_user_policy",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "srv_itsm-server_dev_cicd:itsm-server_dev_cicd",
            "name": "itsm-server_dev_cicd",
            "name_prefix": null,
            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"ecr\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ecr:UploadLayerPart\",\n        \"ecr:PutImage\",\n        \"ecr:InitiateLayerUpload\",\n        \"ecr:GetDownloadUrlForLayer\",\n        \"ecr:CompleteLayerUpload\",\n        \"ecr:BatchGetImage\",\n        \"ecr:BatchCheckLayerAvailability\"\n      ],\n      \"Resource\": \"arn:aws:ecr:us-east-1:255847211468:repository/itsm-server\"\n    },\n    {\n      \"Sid\": \"ecs\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ecs:UpdateService\",\n        \"ecs:RegisterTaskDefinition\",\n        \"ecs:DescribeTaskDefinition\",\n        \"ecs:DescribeServices\",\n        \"ecr:GetAuthorizationToken\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"approle\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"iam:PassRole\",\n      \"Resource\": [\n        \"arn:aws:iam::255847211468:role/itsm-server-dev-ecs\",\n        \"arn:aws:iam::255847211468:role/itsm-server-dev\"\n      ]\n    }\n  ]\n}",
            "user": "srv_itsm-server_dev_cicd"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.app_role",
            "aws_iam_role.ecsTaskExecutionRole",
            "aws_iam_user.cicd"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_kms_alias",
      "name": "sm_kms_alias",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:kms:us-east-1:255847211468:alias/itsm-server-dev",
            "id": "alias/itsm-server-dev",
            "name": "alias/itsm-server-dev",
            "name_prefix": null,
            "target_key_arn": "arn:aws:kms:us-east-1:255847211468:key/8bec25d5-e94d-417d-aaf9-42f4f8d176a3",
            "target_key_id": "8bec25d5-e94d-417d-aaf9-42f4f8d176a3"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_kms_key.sm_kms_key"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_kms_key",
      "name": "sm_kms_key",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:kms:us-east-1:255847211468:key/8bec25d5-e94d-417d-aaf9-42f4f8d176a3",
            "customer_master_key_spec": "SYMMETRIC_DEFAULT",
            "deletion_window_in_days": null,
            "description": "itsm-server-dev",
            "enable_key_rotation": false,
            "id": "8bec25d5-e94d-417d-aaf9-42f4f8d176a3",
            "is_enabled": true,
            "key_id": "8bec25d5-e94d-417d-aaf9-42f4f8d176a3",
            "key_usage": "ENCRYPT_DECRYPT",
            "policy": "{\"Statement\":[{\"Action\":[\"kms:UpdateKeyDescription\",\"kms:UpdateAlias\",\"kms:UntagResource\",\"kms:TagResource\",\"kms:ScheduleKeyDeletion\",\"kms:RevokeGrant\",\"kms:RetireGrant\",\"kms:ReEncryptTo\",\"kms:ReEncryptFrom\",\"kms:PutKeyPolicy\",\"kms:ImportKeyMaterial\",\"kms:GetParametersForImport\",\"kms:GetKeyRotationStatus\",\"kms:GetKeyPolicy\",\"kms:GenerateRandom\",\"kms:GenerateDataKeyWithoutPlaintext\",\"kms:GenerateDataKey\",\"kms:Encrypt\",\"kms:EnableKeyRotation\",\"kms:EnableKey\",\"kms:DisableKeyRotation\",\"kms:DisableKey\",\"kms:DeleteImportedKeyMaterial\",\"kms:DeleteAlias\",\"kms:CreateKey\",\"kms:CreateGrant\",\"kms:CreateAlias\",\"kms:CancelKeyDeletion\"],\"Condition\":{\"StringNotLike\":{\"aws:userId\":[\"AIDAIHSCAW6RPGMTRU5TU\",\"255847211468\"]}},\"Effect\":\"Deny\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":\"*\",\"Sid\":\"DenyWrite\"},{\"Action\":[\"kms:List*\",\"kms:DescribeKey\",\"kms:Decrypt\"],\"Condition\":{\"StringNotLike\":{\"aws:userId\":[\"AIDAIHSCAW6RPGMTRU5TU\",\"255847211468\"]}},\"Effect\":\"Deny\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":\"*\",\"Sid\":\"DenyRead\"},{\"Action\":[\"kms:UpdateKeyDescription\",\"kms:UpdateAlias\",\"kms:UntagResource\",\"kms:TagResource\",\"kms:ScheduleKeyDeletion\",\"kms:RevokeGrant\",\"kms:RetireGrant\",\"kms:ReEncryptTo\",\"kms:ReEncryptFrom\",\"kms:PutKeyPolicy\",\"kms:ImportKeyMaterial\",\"kms:GetParametersForImport\",\"kms:GetKeyRotationStatus\",\"kms:GetKeyPolicy\",\"kms:GenerateRandom\",\"kms:GenerateDataKeyWithoutPlaintext\",\"kms:GenerateDataKey\",\"kms:Encrypt\",\"kms:EnableKeyRotation\",\"kms:EnableKey\",\"kms:DisableKeyRotation\",\"kms:DisableKey\",\"kms:DeleteImportedKeyMaterial\",\"kms:DeleteAlias\",\"kms:CreateKey\",\"kms:CreateGrant\",\"kms:CreateAlias\",\"kms:CancelKeyDeletion\"],\"Condition\":{\"StringLike\":{\"aws:userId\":[\"AIDAIHSCAW6RPGMTRU5TU\",\"255847211468\"]}},\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":\"*\",\"Sid\":\"AllowWrite\"},{\"Action\":[\"kms:List*\",\"kms:DescribeKey\",\"kms:Decrypt\"],\"Condition\":{\"StringLike\":{\"aws:userId\":[\"AIDAIHSCAW6RPGMTRU5TU\",\"255847211468\"]}},\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":\"*\",\"Sid\":\"AllowRead\"}],\"Version\":\"2012-10-17\"}",
            "tags": {
              "Name": "itsm-server-dev",
              "application": "itsm-server",
              "environment": "dev"
            }
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_lambda_alias",
      "name": "ecs_event_stream",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:lambda:us-east-1:255847211468:function:itsm-server-dev-ecs-event-stream:itsm-server-dev-ecs-event-stream",
            "description": "latest",
            "function_name": "itsm-server-dev-ecs-event-stream",
            "function_version": "$LATEST",
            "id": "arn:aws:lambda:us-east-1:255847211468:function:itsm-server-dev-ecs-event-stream:itsm-server-dev-ecs-event-stream",
            "invoke_arn": "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/arn:aws:lambda:us-east-1:255847211468:function:itsm-server-dev-ecs-event-stream:itsm-server-dev-ecs-event-stream/invocations",
            "name": "itsm-server-dev-ecs-event-stream",
            "routing_config": []
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.ecs_event_stream",
            "aws_lambda_function.ecs_event_stream"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_lambda_function",
      "name": "ecs_event_stream",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:lambda:us-east-1:255847211468:function:itsm-server-dev-ecs-event-stream",
            "dead_letter_config": [],
            "description": "",
            "environment": [],
            "file_system_config": [],
            "filename": "lambda-itsm-server.zip",
            "function_name": "itsm-server-dev-ecs-event-stream",
            "handler": "index.handler",
            "id": "itsm-server-dev-ecs-event-stream",
            "invoke_arn": "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/arn:aws:lambda:us-east-1:255847211468:function:itsm-server-dev-ecs-event-stream/invocations",
            "kms_key_arn": "",
            "last_modified": "2020-09-27T21:31:14.674+0000",
            "layers": [],
            "memory_size": 128,
            "publish": false,
            "qualified_arn": "arn:aws:lambda:us-east-1:255847211468:function:itsm-server-dev-ecs-event-stream:$LATEST",
            "reserved_concurrent_executions": -1,
            "role": "arn:aws:iam::255847211468:role/itsm-server-dev-ecs-event-stream",
            "runtime": "nodejs12.x",
            "s3_bucket": null,
            "s3_key": null,
            "s3_object_version": null,
            "source_code_hash": "+mHdOX3i/0vXJVbRt9I11ReaG6nZCs5Ppni00RNDPLg=",
            "source_code_size": 218,
            "tags": {
              "application": "itsm-server",
              "environment": "dev"
            },
            "timeout": 3,
            "timeouts": null,
            "tracing_config": [
              {
                "mode": "PassThrough"
              }
            ],
            "version": "$LATEST",
            "vpc_config": []
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDB9fQ==",
          "dependencies": [
            "aws_iam_role.ecs_event_stream"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_lambda_permission",
      "name": "ecs_event_stream",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "action": "lambda:InvokeFunction",
            "event_source_token": null,
            "function_name": "arn:aws:lambda:us-east-1:255847211468:function:itsm-server-dev-ecs-event-stream",
            "id": "AllowExecutionFromCloudWatch",
            "principal": "events.amazonaws.com",
            "qualifier": "",
            "source_account": null,
            "source_arn": "arn:aws:events:us-east-1:255847211468:rule/itsm-server-dev-ecs-event-stream",
            "statement_id": "AllowExecutionFromCloudWatch",
            "statement_id_prefix": null
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_cloudwatch_event_rule.ecs_event_stream",
            "aws_iam_role.ecs_event_stream",
            "aws_lambda_function.ecs_event_stream"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_route53_record",
      "name": "cert_validation",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "alias": [],
            "allow_overwrite": null,
            "failover_routing_policy": [],
            "fqdn": "_a0cb06e110eb1cf3830c510f4bd734c0.itsm-server-dev.brandonregard.info",
            "geolocation_routing_policy": [],
            "health_check_id": null,
            "id": "Z1S6PFDX73G0UH__a0cb06e110eb1cf3830c510f4bd734c0.itsm-server-dev.brandonregard.info._CNAME",
            "latency_routing_policy": [],
            "multivalue_answer_routing_policy": null,
            "name": "_a0cb06e110eb1cf3830c510f4bd734c0.itsm-server-dev.brandonregard.info",
            "records": [
              "_d9cddec6187d2a6b6908e16f89ea0b1f.bsgbmzkfwj.acm-validations.aws."
            ],
            "set_identifier": null,
            "ttl": 60,
            "type": "CNAME",
            "weighted_routing_policy": [],
            "zone_id": "Z1S6PFDX73G0UH"
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ==",
          "dependencies": [
            "aws_acm_certificate.cert"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_route53_record",
      "name": "staging",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "alias": [],
            "allow_overwrite": null,
            "failover_routing_policy": [],
            "fqdn": "itsm-server-dev.brandonregard.info",
            "geolocation_routing_policy": [],
            "health_check_id": null,
            "id": "Z1S6PFDX73G0UH_itsm-server-dev.brandonregard.info_CNAME",
            "latency_routing_policy": [],
            "multivalue_answer_routing_policy": null,
            "name": "itsm-server-dev.brandonregard.info",
            "records": [
              "itsm-server-dev-672657831.us-east-1.elb.amazonaws.com"
            ],
            "set_identifier": null,
            "ttl": 30,
            "type": "CNAME",
            "weighted_routing_policy": [],
            "zone_id": "Z1S6PFDX73G0UH"
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ==",
          "dependencies": [
            "aws_alb.main"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_s3_bucket",
      "name": "lb_access_logs",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acceleration_status": "",
            "acl": "private",
            "arn": "arn:aws:s3:::itsm-server-dev-lb-access-logs",
            "bucket": "itsm-server-dev-lb-access-logs",
            "bucket_domain_name": "itsm-server-dev-lb-access-logs.s3.amazonaws.com",
            "bucket_prefix": null,
            "bucket_regional_domain_name": "itsm-server-dev-lb-access-logs.s3.amazonaws.com",
            "cors_rule": [],
            "force_destroy": true,
            "grant": [],
            "hosted_zone_id": "Z3AQBSTGFYJSTF",
            "id": "itsm-server-dev-lb-access-logs",
            "lifecycle_rule": [
              {
                "abort_incomplete_multipart_upload_days": 1,
                "enabled": true,
                "expiration": [
                  {
                    "date": "",
                    "days": 3,
                    "expired_object_delete_marker": false
                  }
                ],
                "id": "cleanup",
                "noncurrent_version_expiration": [],
                "noncurrent_version_transition": [],
                "prefix": "",
                "tags": {},
                "transition": []
              }
            ],
            "logging": [],
            "object_lock_configuration": [],
            "policy": null,
            "region": "us-east-1",
            "replication_configuration": [],
            "request_payer": "BucketOwner",
            "server_side_encryption_configuration": [
              {
                "rule": [
                  {
                    "apply_server_side_encryption_by_default": [
                      {
                        "kms_master_key_id": "",
                        "sse_algorithm": "AES256"
                      }
                    ]
                  }
                ]
              }
            ],
            "tags": {
              "application": "itsm-server",
              "environment": "dev"
            },
            "versioning": [
              {
                "enabled": false,
                "mfa_delete": false
              }
            ],
            "website": [],
            "website_domain": null,
            "website_endpoint": null
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_s3_bucket_policy",
      "name": "lb_access_logs",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "bucket": "itsm-server-dev-lb-access-logs",
            "id": "itsm-server-dev-lb-access-logs",
            "policy": "{\"Version\":\"2012-10-17\",\"Id\":\"Policy\",\"Statement\":[{\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"arn:aws:iam::127311923021:root\"},\"Action\":\"s3:PutObject\",\"Resource\":[\"arn:aws:s3:::itsm-server-dev-lb-access-logs\",\"arn:aws:s3:::itsm-server-dev-lb-access-logs/*\"]}]}"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_s3_bucket.lb_access_logs"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_secretsmanager_secret",
      "name": "sm_secret",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-6zWQao",
            "description": "",
            "id": "arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-6zWQao",
            "kms_key_id": "8bec25d5-e94d-417d-aaf9-42f4f8d176a3",
            "name": "itsm-server-dev",
            "name_prefix": null,
            "policy": "{\"Statement\":[{\"Action\":[\"secretsmanager:UpdateSecretVersionStage\",\"secretsmanager:UpdateSecret\",\"secretsmanager:UntagResource\",\"secretsmanager:TagResource\",\"secretsmanager:RotateSecret\",\"secretsmanager:RestoreSecret\",\"secretsmanager:PutSecretValue\",\"secretsmanager:DeleteSecret\",\"secretsmanager:CreateSecret\",\"secretsmanager:CancelRotateSecret\"],\"Condition\":{\"StringNotLike\":{\"aws:userId\":[\"AIDAIHSCAW6RPGMTRU5TU\",\"255847211468\"]}},\"Effect\":\"Deny\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":\"arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-??????\",\"Sid\":\"DenyWrite\"},{\"Action\":[\"secretsmanager:List*\",\"secretsmanager:GetSecretValue\",\"secretsmanager:GetRandomPassword\",\"secretsmanager:DescribeSecret\"],\"Condition\":{\"StringNotLike\":{\"aws:userId\":[\"AIDAIHSCAW6RPGMTRU5TU\",\"255847211468\"]}},\"Effect\":\"Deny\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":\"arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-??????\",\"Sid\":\"DenyRead\"},{\"Action\":[\"secretsmanager:UpdateSecretVersionStage\",\"secretsmanager:UpdateSecret\",\"secretsmanager:UntagResource\",\"secretsmanager:TagResource\",\"secretsmanager:RotateSecret\",\"secretsmanager:RestoreSecret\",\"secretsmanager:PutSecretValue\",\"secretsmanager:DeleteSecret\",\"secretsmanager:CreateSecret\",\"secretsmanager:CancelRotateSecret\"],\"Condition\":{\"StringLike\":{\"aws:userId\":[\"AIDAIHSCAW6RPGMTRU5TU\",\"255847211468\"]}},\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":\"arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-??????\",\"Sid\":\"AllowWrite\"},{\"Action\":[\"secretsmanager:List*\",\"secretsmanager:GetSecretValue\",\"secretsmanager:GetRandomPassword\",\"secretsmanager:DescribeSecret\"],\"Condition\":{\"StringLike\":{\"aws:userId\":[\"AIDAIHSCAW6RPGMTRU5TU\",\"255847211468\"]}},\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"*\"},\"Resource\":\"arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-??????\",\"Sid\":\"AllowRead\"}],\"Version\":\"2012-10-17\"}",
            "recovery_window_in_days": 30,
            "rotation_enabled": false,
            "rotation_lambda_arn": "",
            "rotation_rules": [],
            "tags": {
              "application": "itsm-server",
              "environment": "dev"
            }
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_kms_key.sm_kms_key"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_secretsmanager_secret_version",
      "name": "initial",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-6zWQao",
            "id": "arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-6zWQao|DC46E60F-92BD-4388-AFD9-1CB7AFA8A16A",
            "secret_binary": "",
            "secret_id": "arn:aws:secretsmanager:us-east-1:255847211468:secret:itsm-server-dev-6zWQao",
            "secret_string": "{}",
            "version_id": "DC46E60F-92BD-4388-AFD9-1CB7AFA8A16A",
            "version_stages": [
              "AWSCURRENT"
            ]
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_kms_key.sm_kms_key",
            "aws_secretsmanager_secret.sm_secret"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "nsg_lb",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:255847211468:security-group/sg-0ac5daf49ac9b66fd",
            "description": "Allow connections from external resources while limiting connections from itsm-server-dev-lb to internal resources",
            "egress": [
              {
                "cidr_blocks": [],
                "description": "Only allow SG itsm-server-dev-lb to connect to itsm-server-dev-task on port 3000",
                "from_port": 3000,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [
                  "sg-0e921122ff97e5520"
                ],
                "self": false,
                "to_port": 3000
              }
            ],
            "id": "sg-0ac5daf49ac9b66fd",
            "ingress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "HTTPS",
                "from_port": 443,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 443
              }
            ],
            "name": "itsm-server-dev-lb",
            "name_prefix": null,
            "owner_id": "255847211468",
            "revoke_rules_on_delete": false,
            "tags": {
              "application": "itsm-server",
              "environment": "dev"
            },
            "timeouts": null,
            "vpc_id": "vpc-0b3c769c8c579098f"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "nsg_task",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:255847211468:security-group/sg-0e921122ff97e5520",
            "description": "Limit connections from internal resources while allowing itsm-server-dev-task to connect to all external resources",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "Allows task to establish connections to all resources",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-0e921122ff97e5520",
            "ingress": [
              {
                "cidr_blocks": [],
                "description": "Only allow connections from SG itsm-server-dev-lb on port 3000",
                "from_port": 3000,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [
                  "sg-0ac5daf49ac9b66fd"
                ],
                "self": false,
                "to_port": 3000
              }
            ],
            "name": "itsm-server-dev-task",
            "name_prefix": null,
            "owner_id": "255847211468",
            "revoke_rules_on_delete": false,
            "tags": {
              "application": "itsm-server",
              "environment": "dev"
            },
            "timeouts": null,
            "vpc_id": "vpc-0b3c769c8c579098f"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group_rule",
      "name": "ingress_lb_https",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "cidr_blocks": [
              "0.0.0.0/0"
            ],
            "description": "HTTPS",
            "from_port": 443,
            "id": "sgrule-1109999522",
            "ipv6_cidr_blocks": [],
            "prefix_list_ids": [],
            "protocol": "tcp",
            "security_group_id": "sg-0ac5daf49ac9b66fd",
            "self": false,
            "source_security_group_id": null,
            "to_port": 443,
            "type": "ingress"
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ==",
          "dependencies": [
            "aws_security_group.nsg_lb"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group_rule",
      "name": "nsg_lb_egress_rule",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "cidr_blocks": [],
            "description": "Only allow SG itsm-server-dev-lb to connect to itsm-server-dev-task on port 3000",
            "from_port": 3000,
            "id": "sgrule-854214500",
            "ipv6_cidr_blocks": [],
            "prefix_list_ids": [],
            "protocol": "tcp",
            "security_group_id": "sg-0ac5daf49ac9b66fd",
            "self": false,
            "source_security_group_id": "sg-0e921122ff97e5520",
            "to_port": 3000,
            "type": "egress"
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ==",
          "dependencies": [
            "aws_security_group.nsg_lb",
            "aws_security_group.nsg_task"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group_rule",
      "name": "nsg_task_egress_rule",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "cidr_blocks": [
              "0.0.0.0/0"
            ],
            "description": "Allows task to establish connections to all resources",
            "from_port": 0,
            "id": "sgrule-2205540995",
            "ipv6_cidr_blocks": [],
            "prefix_list_ids": [],
            "protocol": "-1",
            "security_group_id": "sg-0e921122ff97e5520",
            "self": false,
            "source_security_group_id": null,
            "to_port": 0,
            "type": "egress"
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ==",
          "dependencies": [
            "aws_security_group.nsg_task"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group_rule",
      "name": "nsg_task_ingress_rule",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "cidr_blocks": [],
            "description": "Only allow connections from SG itsm-server-dev-lb on port 3000",
            "from_port": 3000,
            "id": "sgrule-1423143846",
            "ipv6_cidr_blocks": [],
            "prefix_list_ids": [],
            "protocol": "tcp",
            "security_group_id": "sg-0e921122ff97e5520",
            "self": false,
            "source_security_group_id": "sg-0ac5daf49ac9b66fd",
            "to_port": 3000,
            "type": "ingress"
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ==",
          "dependencies": [
            "aws_security_group.nsg_lb",
            "aws_security_group.nsg_task"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group_rule",
      "name": "rds_ingress_rule",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 2,
          "attributes": {
            "cidr_blocks": [],
            "description": "Allow Fargate Task to access RDS",
            "from_port": 3306,
            "id": "sgrule-42033748",
            "ipv6_cidr_blocks": [],
            "prefix_list_ids": [],
            "protocol": "tcp",
            "security_group_id": "sg-0f1cb02cbc29de70e",
            "self": false,
            "source_security_group_id": "sg-0e921122ff97e5520",
            "to_port": 3306,
            "type": "ingress"
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjIifQ==",
          "dependencies": [
            "aws_security_group.nsg_task"
          ]
        }
      ]
    }
  ]
}
